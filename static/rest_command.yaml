# https://github.com/chinedu40/enphase_HA_REST_API/blob/main/samples/configuration.yaml
enphase_validate_dtg:
  url: "https://enlighten.enphaseenergy.com/service/batteryConfig/api/v1/battery/sites/{{ battery_id }}/schedules/isValid"
  method: post
  headers:
    content-type: "application/json"
    e-auth-token: "{{ state_attr('sensor.enphase_jwt', 'token') }}"
    x-xsrf-token: "{{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
    username: "{{ user_id }}"
    origin: "https://battery-profile-ui.enphaseenergy.com"
    referer: "https://battery-profile-ui.enphaseenergy.com/"
    cookie: "BP-XSRF-Token={{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
  payload: '{"scheduleType":"dtg"}'

enphase_validate_cfg:
  url: "https://enlighten.enphaseenergy.com/service/batteryConfig/api/v1/battery/sites/{{ battery_id }}/schedules/isValid"
  method: post
  headers:
    content-type: "application/json"
    e-auth-token: "{{ state_attr('sensor.enphase_jwt', 'token') }}"
    x-xsrf-token: "{{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
    username: "{{ user_id }}"
    origin: "https://battery-profile-ui.enphaseenergy.com"
    referer: "https://battery-profile-ui.enphaseenergy.com/"
    cookie: "BP-XSRF-Token={{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
  payload: '{"scheduleType":"cfg","forceScheduleOpted":true}'

enphase_battery_charge_from_grid:
  url: "https://enlighten.enphaseenergy.com/service/batteryConfig/api/v1/batterySettings/{{ battery_id }}?userId={{ user_id }}&source=enho"
  method: put
  headers:
    content-type: "application/json"
    e-auth-token: "{{ state_attr('sensor.enphase_jwt', 'token') }}"
    x-xsrf-token: "{{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
    username: "{{ user_id }}"
    origin: "https://battery-profile-ui.enphaseenergy.com"
    referer: "https://battery-profile-ui.enphaseenergy.com/"
    cookie: "BP-XSRF-Token={{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
  payload: >
    {
      "chargeFromGrid": {{ charge }},
      "acceptedItcDisclaimer": true
    }

enphase_battery_discharge_to_grid:
  url: "https://enlighten.enphaseenergy.com/service/batteryConfig/api/v1/batterySettings/{{ battery_id }}?userId={{ user_id }}&source=enho"
  method: put
  headers:
    content-type: "application/json"
    e-auth-token: "{{ state_attr('sensor.enphase_jwt', 'token') }}"
    x-xsrf-token: "{{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
    username: "{{ user_id }}"
    origin: "https://battery-profile-ui.enphaseenergy.com"
    referer: "https://battery-profile-ui.enphaseenergy.com/"
    cookie: "BP-XSRF-Token={{ state_attr('sensor.enphase_jwt', 'xsrf') }}"
  payload: >
    {
      "dtgControl": {
        "enabled": {{ discharge }}
      }
    }
